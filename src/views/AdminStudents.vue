<template>
  <div class="container my-5">
    <h2 class="text-center text-primary mb-4">👨‍🎓 Upravljanje studentima</h2>

    <div class="card shadow p-4 mb-5">
      <h4 class="mb-3">➕ Dodaj novog studenta</h4>
      <form @submit.prevent="dodajStudenta">
        <div class="row g-3">
          <div class="col-md-4">
            <input v-model="noviStudent.ime" type="text" class="form-control" placeholder="Ime" required />
          </div>
          <div class="col-md-4">
            <input v-model="noviStudent.prezime" type="text" class="form-control" placeholder="Prezime" required />
          </div>
          <div class="col-md-4">
            <input v-model="noviStudent.email" type="email" class="form-control" placeholder="Email" required />
          </div>
        </div>
        <div class="mt-3 d-flex justify-content-between align-items-center">
          <button type="submit" class="btn btn-success">✅ Dodaj</button>
          <span class="text-success">{{ poruka }}</span>
        </div>
      </form>
    </div>

    <div class="card shadow p-4">
      <h4 class="mb-3">📋 Popis studenata</h4>
      <table class="table table-bordered">
        <thead class="table-light">
          <tr>
            <th>Ime</th>
            <th>Prezime</th>
            <th>Email</th>
            <th>Kod</th>
            <th>Akcija</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="student in studenti" :key="student.id">
            <td>{{ student.ime }}</td>
            <td>{{ student.prezime }}</td>
            <td>{{ student.email }}</td>
            <td>{{ student.kod }}</td>
            <td>
              <button class="btn btn-danger btn-sm" @click="obrisiStudenta(student.id)">🗑️ Obriši</button>
            </td>
          </tr>
        </tbody>
      </table>
      <p v-if="studenti.length === 0" class="text-muted text-center">Nema dodanih studenata.</p>
    </div>
  </div>
</template>

<script>
import axios from 'axios';
import { ref, onMounted } from 'vue';

export default {
  name: 'AdminStudents',
  setup() {
    const studenti = ref([]);
    const noviStudent = ref({ ime: '', prezime: '', email: '' });
    const poruka = ref('');

    const ucitajStudente = async () => {
      try {
        const res = await axios.get('http://localhost:3001/students');
        studenti.value = res.data;
      } catch (err) {
        console.error('Greška kod dohvaćanja studenata:', err);
      }
    };

    const dodajStudenta = async () => {
      if (!noviStudent.value.ime || !noviStudent.value.prezime || !noviStudent.value.email) return;

      try {
        await axios.post('http://localhost:3001/students', noviStudent.value);
        poruka.value = 'Student uspješno dodan!';
        noviStudent.value = { ime: '', prezime: '', email: '' };
        ucitajStudente();
      } catch (err) {
        console.error('Greška kod dodavanja:', err);
        poruka.value = 'Greška prilikom dodavanja.';
      }
    };

    const obrisiStudenta = async (id) => {
      try {
        await axios.delete(`http://localhost:3001/students/${id}`);
        ucitajStudente();
      } catch (err) {
        console.error('Greška kod brisanja:', err);
      }
    };

    onMounted(ucitajStudente);

    return { studenti, noviStudent, poruka, dodajStudenta, obrisiStudenta };
  }
};
</script>

<style scoped>
.card {
  border-radius: 10px;
}
input::placeholder {
  font-style: italic;
}
</style>
